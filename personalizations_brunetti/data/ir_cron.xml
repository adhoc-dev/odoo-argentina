<?xml version='1.0' encoding='UTF-8'?>
<odoo>
  <record model="ir.cron" id="personalizations_brunetti.ir_cron_25">
    <field name="name">Cambiar de etapa a las Oportunidades</field>
    <field name="model_id" ref="crm.model_crm_stage"/>
    <field name="state">code</field>
    <field name="binding_type">action</field>
    <field name="code">

stages = model.search([('x_automation_stages', '=', True)])
for stage in stages:
  date_to_change = datetime.datetime.today() + datetime.timedelta(days=-stage.x_days_to_chages)
  leads = env['crm.lead'].search([('stage_id', '=', stage.id), ('x_date_change_stage', '&lt;=', date_to_change)])
  log('Cambiando de etapa {} a los siguientes registros: {}'.format(stage.name, leads.ids))
  for lead in leads:
    lead.message_post(body="Se ha cambiado la etapa automaticamente a: {}".format(stage.x_to_stage_id.name), partner_ids=lead.user_id.partner_id.ids, notif_layout='mail.mail_notification_light')
  leads.write({'stage_id': stage.x_to_stage_id.id})
</field>
    <field name="interval_number">1</field>
    <field name="interval_type">days</field>
    <field name="numbercall">-1</field>
  </record>

  <record model="ir.cron" id="personalizations_brunetti.ir_cron_cancel_sale_orders_by_activity_type">
  <field name="name">Cancelar OVs en cola</field>
    <field name="model_id" ref="mail.model_mail_activity"/>
    <field name="state">code</field>
    <field name="binding_type">action</field>
    <field name="code">
activities = model.search([("res_model","=","sale.order"),("activity_type_id","=", env.ref('personalizations_brunetti.sale_order_to_cancel').id)])
for act in activities.filtered(lambda a: a.state == "overdue"):
    sale = env['sale.order'].browse(act.res_id)
    if sale.state == 'sale' and not sale.invoice_ids and sale.delivery_status != 'delivered':
        sale.action_cancel()
        act.unlink()
    </field>
    <field name="interval_number">1</field>
    <field name="interval_type">days</field>
    <field name="numbercall">-1</field>
  </record>
</odoo>
