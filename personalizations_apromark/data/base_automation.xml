<?xml version='1.0' encoding='UTF-8'?>
<odoo>
<record id="personalizations_apromark.base_automation_validacion_datos" model="base.automation">
    <field name="name">Validacion de datos</field>
    <field ref="base.model_res_partner" name="model_id"/>
    <field name="state">code</field>
    <field name="binding_type">action</field>
    <field name="code">
msg = []
for rec in records:
  domain = [('id', '!=', rec.id), ('company_id', '=', rec.company_id.id)]
  if rec.mobile:
        repeated_partner = records.search(domain + [('mobile', '=', rec.mobile)], limit=1)
        if repeated_partner:
            msg.append('El número de móvil ya existe en otro contacto')
  if rec.email:
        repeated_partner = records.search(domain + [('email', '=', rec.email)])
        if repeated_partner:
            msg.append('El email ya existe en otro contacto')

if msg:
    raise Warning('\n'.join(msg))
</field>
    <field name="trigger">on_create_or_write</field>
  </record>
</odoo>
